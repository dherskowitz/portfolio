---
import Header from '../components/Header.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout>
  <Header />

  <section
    class="container mx-auto m-4 px-4 text-slate-900 flex flex-col gap-4 page-fade"
  >
    <div
      class="px-6 py-8 border-2 border-[color:var(--line)] bg-[color:var(--surface-2)] reveal"
    >
      <h1 class="text-5xl font-bold pb-4 font-display">Contact</h1>
      <p class="text-slate-800 text-lg">
        Have a project or role in mind? Send a note and I will get back to you.
      </p>
    </div>

    <div
      class="px-6 py-8 border-2 border-[color:var(--line)] bg-white/80 backdrop-blur reveal reveal-delay-1 min-h-[420px] flex items-center"
    >
      <form id="contact-form" class="grid gap-6 md:grid-cols-2 w-full">
        <input
          type="hidden"
          name="access_key"
          value="49fe89c3-d4f9-4021-8009-fcb64c152128"
        />
        <input type="hidden" name="subject" value="Portfolio Contact Form" />
        <input type="hidden" name="from_name" value="Portfolio Contact" />

        <label class="flex flex-col gap-2 text-slate-700">
          <span class="text-sm uppercase tracking-wide">Name</span>
          <input
            type="text"
            name="name"
            required
            class="rounded-md border border-[color:var(--line)] bg-white px-4 py-3 text-slate-900 focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-200"
            placeholder="Your name"
          />
        </label>

        <label class="flex flex-col gap-2 text-slate-700">
          <span class="text-sm uppercase tracking-wide">Email</span>
          <input
            type="email"
            name="email"
            required
            class="rounded-md border border-[color:var(--line)] bg-white px-4 py-3 text-slate-900 focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-200"
            placeholder="you@email.com"
          />
        </label>

        <label class="flex flex-col gap-2 text-slate-700 md:col-span-2">
          <span class="text-sm uppercase tracking-wide">Message</span>
          <textarea
            name="message"
            required
            rows="6"
            class="rounded-md border border-[color:var(--line)] bg-white px-4 py-3 text-slate-900 focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-200"
            placeholder="Tell me about your project or role."></textarea>
        </label>

        <button
          type="submit"
          class="inline-flex items-center justify-center px-6 py-3 text-base font-semibold text-slate-900 transition-all duration-200 ease-in-out bg-[color:var(--accent)] hover:bg-amber-400 md:col-span-2 disabled:cursor-not-allowed disabled:opacity-70"
        >
          <span class="button-label">Send Message</span>
          <span
            class="loader hidden ml-3 h-4 w-4 animate-spin rounded-full border-2 border-slate-900 border-t-transparent"
          ></span>
        </button>
      </form>
      <div
        id="form-success"
        class="hidden text-center text-slate-800 w-full"
        aria-live="polite"
      >
        <h2 class="text-3xl font-semibold font-display">Message sent</h2>
        <p class="mt-3 text-lg">
          Thanks for reaching out. I will get back to you shortly.
        </p>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  const form = document.querySelector('#contact-form');
  const success = document.querySelector('#form-success');
  const button = form?.querySelector('button[type="submit"]');
  const label = form?.querySelector('.button-label');
  const loader = form?.querySelector('.loader');

  if (form && button && label && loader && success) {
    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      button.disabled = true;
      label.textContent = 'Sending...';
      loader.classList.remove('hidden');

      try {
        const formData = new FormData(form);
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          body: formData,
          headers: { Accept: 'application/json' },
        });
        const data = await response.json();

        if (data.success) {
          form.classList.add('hidden');
          success.classList.remove('hidden');
          return;
        }

        label.textContent = 'Try Again';
      } catch (error) {
        label.textContent = 'Try Again';
      } finally {
        loader.classList.add('hidden');
        button.disabled = false;
      }
    });
  }
</script>
